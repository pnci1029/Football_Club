# 🔐 서브도메인별 관리자 시스템 개발 계획

## 개요
각 서브도메인마다 독립적인 관리자 권한을 제공하여 팀별로 선수 정보, 구장 정보, 공지사항, 커뮤니티 등 모든 데이터를 관리할 수 있는 시스템 개발

## 1. 데이터베이스 설계
### 1.1 관리자 계정 테이블 생성
- `admin_accounts` 테이블 설계 및 생성
- 서브도메인별 관리자 계정 관리
- 패스워드 암호화 (BCrypt) 적용

### 1.2 권한 관리 테이블 설계
- `admin_permissions` 테이블 생성
- 기능별 권한 세분화 (선수관리, 구장관리, 공지사항 등)

## 2. 백엔드 인증 시스템 구현
### 2.1 JWT 토큰 기반 인증 구현
- JWT 토큰 생성/검증 로직
- 서브도메인별 토큰 격리
- 토큰 만료 및 갱신 처리

### 2.2 관리자 인증 API 개발
- `POST /api/v1/admin/login` - 관리자 로그인
- `POST /api/v1/admin/logout` - 로그아웃
- `GET /api/v1/admin/verify` - 토큰 검증
- `POST /api/v1/admin/refresh` - 토큰 갱신

### 2.3 권한 확인 미들웨어 구현
- API 호출 시 관리자 권한 검증
- 서브도메인별 권한 분리 확인

## 3. 관리자 CRUD API 개발
### 3.1 선수 관리 API
- `GET /api/v1/admin/players` - 선수 목록 조회
- `POST /api/v1/admin/players` - 선수 추가
- `PUT /api/v1/admin/players/{id}` - 선수 정보 수정
- `DELETE /api/v1/admin/players/{id}` - 선수 삭제

### 3.2 구장 정보 관리 API
- `GET /api/v1/admin/venues` - 구장 목록 조회
- `POST /api/v1/admin/venues` - 구장 추가
- `PUT /api/v1/admin/venues/{id}` - 구장 정보 수정
- `DELETE /api/v1/admin/venues/{id}` - 구장 삭제

### 3.3 공지사항 관리 API
- `GET /api/v1/admin/notices` - 공지사항 목록 조회
- `POST /api/v1/admin/notices` - 공지사항 작성
- `PUT /api/v1/admin/notices/{id}` - 공지사항 수정
- `DELETE /api/v1/admin/notices/{id}` - 공지사항 삭제

### 3.4 경기 일정 관리 API
- `GET /api/v1/admin/matches` - 경기 일정 목록 조회
- `POST /api/v1/admin/matches` - 경기 일정 추가
- `PUT /api/v1/admin/matches/{id}` - 경기 일정 수정
- `DELETE /api/v1/admin/matches/{id}` - 경기 일정 삭제

### 3.5 커뮤니티 관리 API
- `GET /api/v1/admin/community/posts` - 게시글 관리 목록
- `PUT /api/v1/admin/community/posts/{id}` - 게시글 수정
- `DELETE /api/v1/admin/community/posts/{id}` - 게시글 삭제
- `POST /api/v1/admin/community/notices` - 공지사항 등록

## 4. 프론트엔드 관리자 페이지 개발
### 4.1 관리자 로그인 페이지
- `/admin/login` 라우트 생성
- 로그인 폼 컴포넌트 개발
- 인증 상태 관리 (Context API 또는 Redux)

### 4.2 관리자 대시보드
- `/admin/dashboard` 메인 대시보드
- 각 관리 기능별 네비게이션
- 통계 정보 표시 (게시글 수, 선수 수 등)

### 4.3 선수 관리 페이지
- `/admin/players` 선수 목록 및 관리
- 선수 추가/수정/삭제 모달
- 선수 프로필 이미지 업로드

### 4.4 구장 관리 페이지
- `/admin/venues` 구장 정보 관리
- 구장 추가/수정/삭제 기능
- 구장 이미지 및 위치 정보 관리

### 4.5 공지사항 관리 페이지
- `/admin/notices` 공지사항 관리
- 리치 텍스트 에디터 (Quill.js 또는 TinyMCE)
- 공지사항 상단 고정 기능

### 4.6 경기 일정 관리 페이지
- `/admin/matches` 경기 일정 관리
- 캘린더 UI로 일정 관리
- 경기 결과 입력 기능

### 4.7 커뮤니티 관리 페이지
- `/admin/community` 게시글 관리
- 부적절한 게시글 숨김/삭제
- 공지사항 작성 및 상단 고정

## 5. 보안 강화
### 5.1 접근 제어 강화
- 관리자 페이지 접근 시 인증 확인
- 비인가 접근 시 자동 리다이렉트
- CSRF 토큰 적용

### 5.2 감사 로그 시스템
- 관리자 활동 로그 기록
- 데이터 변경 이력 추적
- 로그 조회 기능

## 6. UI/UX 개선
### 6.1 관리자 접근 버튼 추가
- 메인 페이지에 "관리자" 버튼 추가
- 권한이 없는 사용자에게는 숨김 처리
- 모바일 반응형 대응

### 6.2 관리자 전용 디자인
- 일반 사용자 페이지와 구별되는 디자인
- 관리 기능에 최적화된 UI
- 일괄 작업 기능 (다중 선택/삭제 등)

## 7. 테스트 및 배포
### 7.1 단위 테스트 작성
- 인증 로직 테스트
- API 권한 검증 테스트
- 서브도메인 격리 테스트

### 7.2 통합 테스트
- 관리자 워크플로우 E2E 테스트
- 보안 취약점 검사
- 성능 테스트

### 7.3 배포 및 모니터링
- 관리자 시스템 배포
- 로그 모니터링 설정
- 보안 이벤트 알림 설정

## 8. 초기 데이터 설정
### 8.1 기본 관리자 계정 생성
- 각 서브도메인별 기본 관리자 계정
- 초기 패스워드 설정 및 변경 강제
- 권한 설정 가이드 문서 작성

---

## 기존 코드 분석 결과

### ✅ 이미 구현된 기능들
1. **Admin 엔티티 및 인증 시스템**
   - `Admin.kt` - 관리자 테이블 (username, password, role, email, name 등)
   - `AdminAuthService.kt` - JWT 기반 로그인/토큰 갱신
   - `AdminAuthController.kt` - 인증 API 엔드포인트
   - `JwtTokenProvider.kt` - JWT 토큰 생성/검증

2. **기존 Admin CRUD 컨트롤러들**
   - `AdminPlayerController.kt` - 선수 관리 ✅
   - `AdminStadiumController.kt` - 구장 관리 ✅  
   - `AdminNoticeController.kt` - 공지사항 관리 ✅
   - `AdminTeamController.kt` - 팀 정보 관리 ✅
   - `AdminInquiryController.kt` - 문의사항 관리 ✅
   - `AdminHeroSlideController.kt` - 메인 슬라이드 관리 ✅

3. **멀티테넌트 지원**
   - `teamSubdomain` 필드가 Community, Notice 등에 이미 존재
   - `TenantController.kt` - 테넌트 관리 기능
   - 서브도메인 기반 데이터 격리 구조

### ⚠️ 누락된 기능들 (새로 개발 필요)
1. **2단계 Admin 권한 구조 설계**
   - **마스터 관리자**: 모든 서브도메인 관리, 서브도메인별 관리자 계정 생성/관리
   - **서브도메인 관리자**: 특정 서브도메인에서만 로그인 가능, 해당 팀 데이터만 관리
   - 현재 Admin 테이블에 `teamSubdomain` 및 `adminLevel` 필드 없음

2. **마스터 관리자 전용 기능**
   - 서브도메인별 관리자 계정 생성/수정/삭제 API
   - 전체 서브도메인 통계 및 모니터링
   - 서브도메인별 관리자 권한 관리

3. **서브도메인별 로그인 제한**
   - 서브도메인 관리자는 해당 서브도메인에서만 로그인 가능
   - 마스터 관리자는 모든 서브도메인 접근 가능

4. **커뮤니티 관리 기능**
   - 커뮤니티 게시글 관리 API 없음
   - 부적절한 게시글 숨김/삭제 기능 없음

5. **프론트엔드 관리자 페이지**
   - 현재 백엔드 API만 존재, 프론트엔드 없음

## 개발 공수 산정 (수정됨)

### Phase 1: 2단계 Admin 권한 시스템 (4일)
- [ ] **Admin 테이블 수정** - `teamSubdomain`, `adminLevel` 필드 추가 (0.5일)
- [ ] **AdminAuthService 수정** - 서브도메인별 로그인 제한 로직 (1.5일)
- [ ] **권한 검증 미들웨어** - 마스터/서브도메인 관리자 구분 (1일)
- [ ] **Admin 계정 초기화 스크립트** - 마스터 계정 + 서브도메인별 기본 계정 (1일)

### Phase 2: 마스터 관리자 전용 기능 (3일)
- [ ] **AdminManagementController 신규 개발** - 서브도메인 관리자 CRUD (1.5일)
- [ ] **AdminManagementService** - 관리자 계정 생성/관리 로직 (1일)
- [ ] **전체 서브도메인 통계 API** (0.5일)

### Phase 3: 커뮤니티 관리 기능 추가 (2일)
- [ ] **AdminCommunityController 신규 개발** (1일)
- [ ] **커뮤니티 관리 서비스 로직** (1일)

### Phase 4: 프론트엔드 개발 (7일)
- [ ] **관리자 로그인 페이지** `/admin/login` - 서브도메인 제한 적용 (1.5일)
- [ ] **마스터 관리자 대시보드** `/admin/master/dashboard` - 전체 서브도메인 관리 (1.5일)
- [ ] **서브도메인 관리자 대시보드** `/admin/dashboard` - 팀별 관리 (1일)
- [ ] **마스터 전용: 관리자 계정 관리 페이지** `/admin/master/admins` (1.5일)
- [ ] **기존 관리 페이지들** - 선수/구장/공지사항/팀 (1일)
- [ ] **커뮤니티 관리 페이지** (0.5일)

### Phase 5: UI/UX 개선 (2일)
- [ ] **메인 페이지 "관리자" 버튼 추가** (0.5일)
- [ ] **관리자 전용 네비게이션** - 권한별 메뉴 구분 (1일)
- [ ] **반응형 디자인 적용** (0.5일)

### Phase 6: 보안 및 테스트 (2일)
- [ ] **권한 검증 강화** - 마스터/서브도메인 권한 테스트 (1일)
- [ ] **통합 테스트 작성** (1일)

## 총 개발 공수: 20일 (약 4주)

### 코드 재사용률: 약 60%
- 기존 Admin CRUD API들 활용 가능
- JWT 인증 시스템 재사용
- 멀티테넌트 구조 기반 활용
- **신규 개발 비중: 40%** (마스터 관리자 기능, 권한 분리, 프론트엔드)

### 우선순위 개발 순서
1. **Phase 1** - 2단계 Admin 권한 시스템 (핵심 기능)
2. **Phase 2** - 마스터 관리자 전용 기능 (관리자 계정 관리)
3. **Phase 4** - 프론트엔드 기본 페이지들 (사용자 경험)
4. **Phase 3** - 커뮤니티 관리 (부가 기능)
5. **Phase 5, 6** - UI 개선 및 테스트

## 새로운 Admin 권한 구조

### 마스터 관리자 (adminLevel: "MASTER")
- **접근 가능**: 모든 서브도메인 
- **기능**: 
  - 서브도메인별 관리자 계정 생성/수정/삭제
  - 전체 서브도메인 통계 조회
  - 모든 서브도메인 데이터 관리 가능
- **로그인**: 어느 서브도메인에서든 가능

### 서브도메인 관리자 (adminLevel: "SUBDOMAIN")
- **접근 제한**: 지정된 `teamSubdomain`에서만 로그인 가능
- **기능**:
  - 해당 팀의 선수/구장/공지사항/커뮤니티 관리
  - 팀별 데이터만 접근 가능
- **로그인**: 해당 서브도메인에서만 가능 (예: team1.domain.com에서만)

## ⚠️ 중요: 기존 시스템 영향도

### 무영향 보장 원칙
**이 관리자 시스템의 추가 또는 부재와 관계없이 기존의 모든 시스템은 아무런 영향을 받지 않아야 함**

### 구체적 보장사항
1. **기존 사용자 기능 무영향**
   - 커뮤니티, 선수 조회, 경기 일정, 공지사항 등 모든 일반 사용자 기능
   - 기존 API 엔드포인트 변경 없음
   - 프론트엔드 일반 사용자 페이지 무변경

2. **기존 데이터 무영향**
   - 기존 테이블 구조 보존 (Admin 테이블만 필드 추가)
   - 기존 데이터 손실 없음
   - 기존 관계형 데이터 구조 유지

3. **기존 배포 시스템 무영향**
   - 현재 배포 프로세스 변경 없음
   - 관리자 시스템 없이도 정상 동작
   - 점진적 배포 가능 (관리자 기능만 별도 배포)

4. **기존 인증 시스템 무영향**
   - JWT 토큰 구조 하위 호환성 보장
   - 기존 보안 설정 유지
   - 일반 사용자 인증 로직 무변경

5. **서비스 중단 없음**
   - 관리자 시스템 개발/배포 중에도 서비스 정상 운영
   - 롤백 시에도 기존 기능 100% 보장
   - 점진적 기능 활성화 가능

### 개발 방식
- **Additive Only**: 기존 코드 수정 최소화, 새로운 기능만 추가
- **Feature Flag**: 관리자 기능 활성화/비활성화 가능
- **Backward Compatibility**: 모든 변경사항은 하위 호환성 보장

**문서 수정일**: 2025년 1월 16일  
**상태**: 기존 코드 분석 완료, 개발 공수 산정 완료, 무영향 보장 정책 수립